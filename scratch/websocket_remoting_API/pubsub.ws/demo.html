<html>
<head>

<script language="javascript" src="jquery.min.js"></script>
<script language="javascript" src="json2.js"></script>
<script>
global = this;
$(function() {

channel = WebSocket("ws://localhost:8080/chatrooms/ireland/")
channel.onopen = function(evt) {
  console.log("channel open;", evt);
  channel.send(JSON.stringify({nickname: "McSkills"+Math.floor(Math.random()*222)}))
}
channel.onmessage = function(evt) {
 console.log("channel message;", evt);
 msg = evt.data
 console.log("it contained", msg) 
 recvchat("nobody", msg)
}

inputbox = $("#inputbox")

function recvchat(username, message) {
  display = $("#chatwindow textarea")
  display.val(
    display.val() + "\n" +
    username + ": " + message
  )
}

function sendchat() {
  channel.send(inputbox.val())
  inputbox.val(null);
}

inputbox.keydown(function(evt) {
  console.log(evt)
  if(evt.which == 13) { //enter
    sendchat()
    return false; //make the form not submit
  }
})

global.inputbox = inputbox;
global.channel = channel;

})
</script>

</head>
<body>
<form id="chatwindow" target="_NULL">
<textarea>
The chat
goes here
</textarea>
<input type="text" id="inputbox"></input>
</form>

</body>
</html>
